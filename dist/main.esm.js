import*as n from"react";import*as e from"prop-types";var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])},t(n,e)};var o=function(){return o=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},o.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var r,i,a={onActivate:e.func,onAddUndo:e.func,onBeforeAddUndo:e.func,onBeforeExecCommand:e.func,onBeforeGetContent:e.func,onBeforeRenderUI:e.func,onBeforeSetContent:e.func,onBeforePaste:e.func,onBlur:e.func,onChange:e.func,onClearUndos:e.func,onClick:e.func,onContextMenu:e.func,onCommentChange:e.func,onCompositionEnd:e.func,onCompositionStart:e.func,onCompositionUpdate:e.func,onCopy:e.func,onCut:e.func,onDblclick:e.func,onDeactivate:e.func,onDirty:e.func,onDrag:e.func,onDragDrop:e.func,onDragEnd:e.func,onDragGesture:e.func,onDragOver:e.func,onDrop:e.func,onExecCommand:e.func,onFocus:e.func,onFocusIn:e.func,onFocusOut:e.func,onGetContent:e.func,onHide:e.func,onInit:e.func,onInput:e.func,onKeyDown:e.func,onKeyPress:e.func,onKeyUp:e.func,onLoadContent:e.func,onMouseDown:e.func,onMouseEnter:e.func,onMouseLeave:e.func,onMouseMove:e.func,onMouseOut:e.func,onMouseOver:e.func,onMouseUp:e.func,onNodeChange:e.func,onObjectResizeStart:e.func,onObjectResized:e.func,onObjectSelected:e.func,onPaste:e.func,onPostProcess:e.func,onPostRender:e.func,onPreProcess:e.func,onProgressState:e.func,onRedo:e.func,onRemove:e.func,onReset:e.func,onSaveContent:e.func,onSelectionChange:e.func,onSetAttrib:e.func,onSetContent:e.func,onShow:e.func,onSubmit:e.func,onUndo:e.func,onVisualAid:e.func,onSkinLoadError:e.func,onThemeLoadError:e.func,onModelLoadError:e.func,onPluginLoadError:e.func,onIconsLoadError:e.func,onLanguageLoadError:e.func,onScriptsLoad:e.func,onScriptsLoadError:e.func},s=o({apiKey:e.string,id:e.string,inline:e.bool,init:e.object,initialValue:e.string,onEditorChange:e.func,value:e.string,tagName:e.string,tabIndex:e.number,cloudChannel:e.string,plugins:e.oneOfType([e.string,e.array]),toolbar:e.oneOfType([e.string,e.array]),disabled:e.bool,textareaName:e.string,tinymceScriptSrc:e.oneOfType([e.string,e.arrayOf(e.string),e.arrayOf(e.shape({src:e.string,async:e.bool,defer:e.bool}))]),rollback:e.oneOfType([e.number,e.oneOf([!1])]),scriptLoading:e.shape({async:e.bool,defer:e.bool,delay:e.number})},a),c=function(n){return"function"==typeof n},u=function(n){return n in a},l=function(n){return n.substr(2)},d=function(n,e,t,o,r){return function(n,e,t,o,r,i,a){var s=Object.keys(r).filter(u),c=Object.keys(i).filter(u),d=s.filter(function(n){return void 0===i[n]}),p=c.filter(function(n){return void 0===r[n]});d.forEach(function(n){var e=l(n),o=a[e];t(e,o),delete a[e]}),p.forEach(function(t){var r=o(n,t),i=l(t);a[i]=r,e(i,r)})}(r,n.on.bind(n),n.off.bind(n),function(e,t){return function(o){var r;return null===(r=e(t))||void 0===r?void 0:r(o,n)}},e,t,o)},p=0,f=function(n){var e=Date.now();return n+"_"+Math.floor(1e9*Math.random())+ ++p+String(e)},h=function(n){return null!==n&&("textarea"===n.tagName.toLowerCase()||"input"===n.tagName.toLowerCase())},v=function(n){return void 0===n||""===n?[]:Array.isArray(n)?n:n.split(" ")},y=function(n,e){void 0!==n&&(null!=n.mode&&"object"==typeof n.mode&&"function"==typeof n.mode.set?n.mode.set(e):n.setMode(e))},m=function(n,e,t){var o,r,i=n.createElement("script");i.referrerPolicy="origin",i.type="application/javascript",i.id=e.id,i.src=e.src,i.async=null!==(o=e.async)&&void 0!==o&&o,i.defer=null!==(r=e.defer)&&void 0!==r&&r;var a=function(){i.removeEventListener("load",a),i.removeEventListener("error",s),t(e.src)},s=function(n){i.removeEventListener("load",a),i.removeEventListener("error",s),t(e.src,n)};i.addEventListener("load",a),i.addEventListener("error",s),n.head&&n.head.appendChild(i)},g=(r=[],i=function(n){var e=r.find(function(e){return e.getDocument()===n});return void 0===e&&(e=function(n){var e={},t=function(n,t){var o=e[n];o.done=!0,o.error=t;for(var r=0,i=o.handlers;r<i.length;r++)(0,i[r])(n,t);o.handlers=[]};return{loadScripts:function(r,i,a){var s=function(n){return void 0!==a?a(n):console.error(n)};if(0!==r.length)for(var c=0,u=!1,l=function(n,e){u||(e?(u=!0,s(e)):++c===r.length&&i())},d=0,p=r;d<p.length;d++){var h=p[d],v=e[h.src];if(v)v.done?l(h.src,v.error):v.handlers.push(l);else{var y=f("tiny-");e[h.src]={id:y,src:h.src,done:!1,error:null,handlers:[l]},m(n,o({id:y},h),t)}}else s(new Error("At least one script must be provided"))},deleteScripts:function(){for(var t,o=0,r=Object.values(e);o<r.length;o++){var i=r[o],a=n.getElementById(i.id);null!=a&&"SCRIPT"===a.tagName&&(null===(t=a.parentNode)||void 0===t||t.removeChild(a))}e={}},getDocument:function(){return n}}}(n),r.push(e)),e},{loadList:function(n,e,t,o,r){var a=function(){return i(n).loadScripts(e,o,r)};t>0?setTimeout(a,t):a()},reinitialize:function(){for(var n=r.pop();null!=n;n=r.pop())n.deleteScripts()}}),b=function(n){var e=n;return e&&e.tinymce?e.tinymce:null};!function(n,e){void 0===e&&(e={});var t=e.insertAt;if("undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===t&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}(".tox-promotion,\n.tox-promotion,\n.tox-statusbar__branding {\n  display: none !important;\n}\n");var C=function(e){function r(t){var r,i,a,s=e.call(this,t)||this;return s.rollbackTimer=void 0,s.valueCursor=void 0,s.rollbackChange=function(){var n=s.editor,e=s.props.value;n&&e&&e!==s.currentContent&&n.undoManager.ignore(function(){if(n.setContent(e),s.valueCursor&&(!s.inline||n.hasFocus()))try{n.selection.moveToBookmark(s.valueCursor)}catch(n){}}),s.rollbackTimer=void 0},s.handleBeforeInput=function(n){if(void 0!==s.props.value&&s.props.value===s.currentContent&&s.editor&&(!s.inline||s.editor.hasFocus()))try{s.valueCursor=s.editor.selection.getBookmark(3)}catch(n){}},s.handleBeforeInputSpecial=function(n){"Enter"!==n.key&&"Backspace"!==n.key&&"Delete"!==n.key||s.handleBeforeInput(n)},s.handleEditorChange=function(n){var e=s.editor;if(e&&e.initialized){var t=e.getContent();void 0!==s.props.value&&s.props.value!==t&&!1!==s.props.rollback&&(s.rollbackTimer||(s.rollbackTimer=window.setTimeout(s.rollbackChange,"number"==typeof s.props.rollback?s.props.rollback:200))),t!==s.currentContent&&(s.currentContent=t,c(s.props.onEditorChange)&&s.props.onEditorChange(t,e))}},s.handleEditorChangeSpecial=function(n){"Backspace"!==n.key&&"Delete"!==n.key||s.handleEditorChange(n)},s.initialise=function(n){var e,t,r;void 0===n&&(n=0);var i=s.elementRef.current;if(i)if(function(n){if(!("isConnected"in Node.prototype)){for(var e=n,t=n.parentNode;null!=t;)t=(e=t).parentNode;return e===n.ownerDocument}return n.isConnected}(i)){var a=b(s.view);if(!a)throw new Error("tinymce should have been loaded into global scope");var u,l,d=o(o({},s.props.init),{selector:void 0,target:i,readonly:s.props.disabled,inline:s.inline,plugins:(u=null===(e=s.props.init)||void 0===e?void 0:e.plugins,l=s.props.plugins,v(u).concat(v(l))),toolbar:null!==(t=s.props.toolbar)&&void 0!==t?t:null===(r=s.props.init)||void 0===r?void 0:r.toolbar,setup:function(n){s.editor=n,s.bindHandlers({}),s.inline&&!h(i)&&n.once("PostRender",function(e){n.setContent(s.getInitialValue(),{no_events:!0})}),s.props.init&&c(s.props.init.setup)&&s.props.init.setup(n)},init_instance_callback:function(n){var e,t,o=s.getInitialValue();s.currentContent=null!==(e=s.currentContent)&&void 0!==e?e:n.getContent(),s.currentContent!==o&&(s.currentContent=o,n.setContent(o),n.undoManager.clear(),n.undoManager.add(),n.setDirty(!1));var r=null!==(t=s.props.disabled)&&void 0!==t&&t;y(s.editor,r?"readonly":"design"),s.props.init&&c(s.props.init.init_instance_callback)&&s.props.init.init_instance_callback(n)}});s.inline||(i.style.visibility=""),h(i)&&(i.value=s.getInitialValue()),a.init(d)}else if(0===n)setTimeout(function(){return s.initialise(1)},1);else{if(!(n<100))throw new Error("tinymce can only be initialised when in a document");setTimeout(function(){return s.initialise(n+1)},100)}},s.id=s.props.id||f("tiny-react"),s.elementRef=n.createRef(),s.inline=null!==(a=null!==(r=s.props.inline)&&void 0!==r?r:null===(i=s.props.init)||void 0===i?void 0:i.inline)&&void 0!==a&&a,s.boundHandlers={},s}return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}(r,e),Object.defineProperty(r.prototype,"view",{get:function(){var n,e,t;return null!==(t=null===(e=null===(n=this.elementRef.current)||void 0===n?void 0:n.ownerDocument)||void 0===e?void 0:e.defaultView)&&void 0!==t?t:window},enumerable:!1,configurable:!0}),r.prototype.componentDidUpdate=function(n){var e,t,o=this;if(this.rollbackTimer&&(window.clearTimeout(this.rollbackTimer),this.rollbackTimer=void 0),this.editor&&(this.bindHandlers(n),this.editor.initialized)){if(this.currentContent=null!==(e=this.currentContent)&&void 0!==e?e:this.editor.getContent(),"string"==typeof this.props.initialValue&&this.props.initialValue!==n.initialValue)this.editor.setContent(this.props.initialValue),this.editor.undoManager.clear(),this.editor.undoManager.add(),this.editor.setDirty(!1);else if("string"==typeof this.props.value&&this.props.value!==this.currentContent){var r=this.editor;r.undoManager.transact(function(){var n;if(!o.inline||r.hasFocus())try{n=r.selection.getBookmark(3)}catch(n){}var e=o.valueCursor;if(r.setContent(o.props.value),!o.inline||r.hasFocus())for(var t=0,i=[n,e];t<i.length;t++){var a=i[t];if(a)try{r.selection.moveToBookmark(a),o.valueCursor=a;break}catch(n){}}})}if(this.props.disabled!==n.disabled){var i=null!==(t=this.props.disabled)&&void 0!==t&&t;y(this.editor,i?"readonly":"design")}}},r.prototype.componentDidMount=function(){var n,e,t,o,r,i=this;if(null!==b(this.view))this.initialise();else if(Array.isArray(this.props.tinymceScriptSrc)&&0===this.props.tinymceScriptSrc.length)null===(e=(n=this.props).onScriptsLoadError)||void 0===e||e.call(n,new Error("No `tinymce` global is present but the `tinymceScriptSrc` prop was an empty array."));else if(null===(t=this.elementRef.current)||void 0===t?void 0:t.ownerDocument){g.loadList(this.elementRef.current.ownerDocument,this.getScriptSources(),null!==(r=null===(o=this.props.scriptLoading)||void 0===o?void 0:o.delay)&&void 0!==r?r:0,function(){var n,e;null===(e=(n=i.props).onScriptsLoad)||void 0===e||e.call(n),i.initialise()},function(n){var e,t;null===(t=(e=i.props).onScriptsLoadError)||void 0===t||t.call(e,n)})}},r.prototype.componentWillUnmount=function(){var n=this,e=this.editor;e&&(e.off(this.changeEvents(),this.handleEditorChange),e.off(this.beforeInputEvent(),this.handleBeforeInput),e.off("keypress",this.handleEditorChangeSpecial),e.off("keydown",this.handleBeforeInputSpecial),e.off("NewBlock",this.handleEditorChange),Object.keys(this.boundHandlers).forEach(function(t){e.off(t,n.boundHandlers[t])}),this.boundHandlers={},e.remove(),this.editor=void 0)},r.prototype.render=function(){return this.inline?this.renderInline():this.renderIframe()},r.prototype.changeEvents=function(){var n,e,t;return(null===(t=null===(e=null===(n=b(this.view))||void 0===n?void 0:n.Env)||void 0===e?void 0:e.browser)||void 0===t?void 0:t.isIE())?"change keyup compositionend setcontent CommentChange":"change input compositionend setcontent CommentChange"},r.prototype.beforeInputEvent=function(){return window.InputEvent&&"function"==typeof InputEvent.prototype.getTargetRanges?"beforeinput SelectionChange":"SelectionChange"},r.prototype.renderInline=function(){var e=this.props.tagName,t=void 0===e?"div":e;return n.createElement(t,{ref:this.elementRef,id:this.id,tabIndex:this.props.tabIndex})},r.prototype.renderIframe=function(){return n.createElement("textarea",{ref:this.elementRef,style:{visibility:"hidden"},name:this.props.textareaName,id:this.id,tabIndex:this.props.tabIndex})},r.prototype.getScriptSources=function(){var n,e,t=null===(n=this.props.scriptLoading)||void 0===n?void 0:n.async,o=null===(e=this.props.scriptLoading)||void 0===e?void 0:e.defer;if(void 0!==this.props.tinymceScriptSrc)return"string"==typeof this.props.tinymceScriptSrc?[{src:this.props.tinymceScriptSrc,async:t,defer:o}]:this.props.tinymceScriptSrc.map(function(n){return"string"==typeof n?{src:n,async:t,defer:o}:n});return[{src:"https://cdn.jsdelivr.net/npm/tinymce@7.9.1/tinymce.min.js",async:t,defer:o}]},r.prototype.getInitialValue=function(){return"string"==typeof this.props.initialValue?this.props.initialValue:"string"==typeof this.props.value?this.props.value:""},r.prototype.bindHandlers=function(n){var e=this;if(void 0!==this.editor){d(this.editor,n,this.props,this.boundHandlers,function(n){return e.props[n]});var t=function(n){return void 0!==n.onEditorChange||void 0!==n.value},o=t(n),r=t(this.props);!o&&r?(this.editor.on(this.changeEvents(),this.handleEditorChange),this.editor.on(this.beforeInputEvent(),this.handleBeforeInput),this.editor.on("keydown",this.handleBeforeInputSpecial),this.editor.on("keyup",this.handleEditorChangeSpecial),this.editor.on("NewBlock",this.handleEditorChange)):o&&!r&&(this.editor.off(this.changeEvents(),this.handleEditorChange),this.editor.off(this.beforeInputEvent(),this.handleBeforeInput),this.editor.off("keydown",this.handleBeforeInputSpecial),this.editor.off("keyup",this.handleEditorChangeSpecial),this.editor.off("NewBlock",this.handleEditorChange))}},r.propTypes=s,r.defaultProps={cloudChannel:"7"},r}(n.Component);export{C as Editor};
